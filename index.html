<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>TOP SQA Posts</title>
    <link rel="stylesheet" href="resources/css/normalize.css">
    <link rel="stylesheet" href="resources/css/style.css">
    <script src="https://apis.google.com/js/api.js"></script>
  </head>
  <body>
    <script>
      function loadClient() {
        gapi.client.setApiKey("AIzaSyC8MhiHwrOeQhxckyMRKVWmP1dwkNdQhdg");
        return gapi.client.load("https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest")
            .then(function() { console.log("GAPI client loaded for API"); },
                  function(err) { console.error("Error loading GAPI client for API", err); });
      }

      function execute() {
        gapi.client.youtube.search.list({
          "maxResults": 12,
          "order": "rating",
          "q": "software quality assurance"
        })
            .then(function(response) {
                console.log("Response", response.body);

                // Add Iframe
                const iframe = document.createElement("iframe");
                let src = `https://www.youtube.com/embed/VIDEO_ID?playlist=`;
            
                const responseBody = JSON.parse(response.body);
                const items = responseBody.items;

                let video_list = "";
                for (const item of items) {
                  console.log("Video ID:", item.id.videoId);
                  video_list += item.id.videoId + ",";
                }
                video_list = video_list.substring(0, video_list.length - 1);
                console.log(video_list);

                src = src + video_list;
                console.log("Loading Videos for: " + src);

                iframe.src = src;
                iframe.frameBorder = 0;
                iframe.allowFullscreen = true;

                const cntYoutubePlayer = document.querySelector(".cnt-youtubeplayer");
                cntYoutubePlayer.appendChild(iframe);
            },
            function(err) { console.error("Execute error", err); });
      }
      gapi.load("client");
    </script>

    <div class="cnt-main">
      <h1>TOP 12 SQA Posts</h1>
      <h2>on Youtube</h2>
      <div class="cnt-youtubeplayer"></div>
      <button onclick="loadClient()">Load</button>
      <button onclick="execute()">Execute Show TOP 12 SQA Videos on YouTube</button>
    </div>
  </body>
</html>